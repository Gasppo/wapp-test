// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model WhatsappEntry {
  id     Int     @id @default(autoincrement())
  object String
  entry  Entry[]
}

model Entry {
  id              Int            @id @default(autoincrement())
  changes         Change[]
  WhatsappEntry   WhatsappEntry? @relation(fields: [whatsappEntryId], references: [id])
  whatsappEntryId Int?

  @@index([whatsappEntryId], name: "whatsappEntryId")
}

model Change {
  id      Int    @id @default(autoincrement())
  field   String
  value   Value  @relation(fields: [valueId], references: [id])
  Entry   Entry? @relation(fields: [entryId], references: [id])
  entryId Int?
  valueId Int

  @@index([entryId], name: "entryId")
  @@index([valueId], name: "valueId")
}

model Value {
  id                Int       @id @default(autoincrement())
  messaging_product String
  metadata          Metadata  @relation(fields: [metadataId], references: [id])
  contacts          Contact[]
  messages          Message[]
  Change            Change[]
  metadataId        Int

  @@index([metadataId], name: "metadataId")
}

model Contact {
  id        Int     @id @default(autoincrement())
  profile   Profile @relation(fields: [profileId], references: [id])
  wa_id     String
  Value     Value?  @relation(fields: [valueId], references: [id])
  valueId   Int?
  profileId Int

  @@index([profileId], name: "profileId")
  @@index([valueId], name: "valueId")
}

model Profile {
  id      Int       @id @default(autoincrement())
  name    String
  Contact Contact[]
}

model Message {
  id        Int    @id @default(autoincrement())
  from      String
  timestamp String
  text      Text   @relation(fields: [textId], references: [id])
  type      String
  Value     Value? @relation(fields: [valueId], references: [id])
  valueId   Int?
  textId    Int

  @@index([textId], name: "textId")
  @@index([valueId], name: "valueId")
}

model Text {
  id      Int       @id @default(autoincrement())
  body    String
  Message Message[]
}

model Metadata {
  id                   Int     @id @default(autoincrement())
  display_phone_number String
  phone_number_id      String
  Value                Value[]
}
